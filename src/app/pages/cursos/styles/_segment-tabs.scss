/**
 * Estilos para Ion-Segment (Tabs)
 * Usa el sistema de variables y mixins para consistencia
 */

@use 'sass:color';
@use '../styles/variables' as *;
@use '../styles/mixins' as *;
@use '../../../shared/styles/course-tabs' as *;
@use '../../../shared/styles/breakpoints' as bp; // Import breakpoints
@use '../../../shared/styles/typography-mixins' as typo; // Typography mixins

// ============================================
// COURSE SELECTOR TABS (DESKTOP + TABLET)
// ============================================

.cursos-container>ion-segment {
    background: linear-gradient(135deg, $azul-oscuro 0%, color.adjust($azul-oscuro, $lightness: 10%) 100%);
    border-radius: $radius-md;
    padding: spacing('xs');
    margin-bottom: spacing('md');
    @include card-elevation(2);

    ion-segment {
        --background: transparent;
        padding: 0;
        margin: 0;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        min-height: 56px; // WCAG touch target + padding

        &::-webkit-scrollbar {
            display: none;
        }
    }

    // Individual course buttons
    ion-segment-button {
        --background: #{$azul-oscuro};
        --background-checked: #{$azul-oscuro};
        --color: rgba(255, 255, 255, 0.75);
        --color-checked: var(--ion-color-primary-contrast);
        --indicator-color: var(--azul-claro, var(--ion-color-primary));
        --indicator-height: 2px; // Reduced from 3px
        --border-radius: #{$radius-sm};
        --padding-start: calc(#{spacing('sm')} + 12px); // Stripe width compensation
        --padding-end: spacing('sm');
        --padding-top: spacing('xs');
        --padding-bottom: spacing('xs');
        --margin-end: spacing('xs');

        min-width: 140px; // Tablet: compact
        max-width: 240px; // Tablet: limit
        flex: 0 0 auto;
        text-transform: none;
        font-weight: font-weight('semibold');
        position: relative;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-light);
        margin-bottom: spacing('xs');
        overflow: hidden;

        // Desktop: allow full expansion
        @media (min-width: 992px) {
            min-width: 180px;
            max-width: none;
        }

        // Color stripe (left edge)
        &::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 12px; // Reduced from 15px
            background: var(--course-stripe-color, var(--azul-oscuro));
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1;
        }

        &:hover {
            box-shadow: var(--shadow-medium);
            transform: translateY(-1px);
        }

        &.segment-button-checked {
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--ion-color-primary-contrast); // Reduced from 2px
            --background: #{$azul-oscuro};
            --color: var(--ion-color-primary-contrast);

            &::before {
                border-right-color: rgba(255, 255, 255, 0.4);
            }

            .tab-nombre,
            .tablet-label,
            .mobile-tablet-label {
                color: var(--ion-color-primary-contrast);
                font-weight: font-weight('bold');
            }

            .tab-codigo {
                color: rgba(255, 255, 255, 0.85);
            }
        }
    }
}

// Additional segment button states
ion-segment-button {

    &.segment-button-layout-icon-top {
        // Asegura que el contenido vertical esté bien alineado
        min-height: 4rem; // ~64px
    }

    &.segment-button-checked {
        font-weight: font-weight('bold');
        --color: #ffffff;
    }

    &.segment-button-has-label-only {
        // Ajustes para tabs con solo label
        min-height: 3rem; // ~48px
    }

    // Contenedor de labels (nombre + código)
    .tab-label-container {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: spacing('xs');
        transition: all 0.2s ease;

        // Simple Mobile Label (Hidden by default on Desktop)
        .mobile-label {
            display: none; // Default: hidden
            color: #ffffff;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 0.5px;
        }

        // Mobile + Tablet Label (EPM-B01, EPM-B02) - Show full text
        .mobile-tablet-label {
            color: #ffffff;
            font-weight: 600;
            font-size: 14px; // Clear readable size
            letter-spacing: 0.3px;
            white-space: nowrap; // Keep on one line
            text-align: center;
        }

        .tab-content-wrapper.desktop-view {
            display: flex; // Default: visible
        }

        .tab-content-wrapper {
            background: transparent;
            padding: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 2px;
            border: none;
            box-shadow: none;
        }

        // Nombre del curso
        .tab-nombre {
            display: block;
            word-wrap: break-word; // Mobile: permitir saltos de línea
            color: #ffffff;
            text-align: left;
            width: 100%;
            @include typo.typography-tab-nombre;

            // Desktop: una sola fila
            @media (min-width: 992px) {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }

        // Código del curso - SEGUNDA FILA
        .tab-codigo {
            opacity: 0.75;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            display: block;
            color: rgba(255, 255, 255, 0.8);
            @include typo.typography-tab-codigo;
            text-align: left;
        }
    }

    // Efecto hover/checked simplificado (sin contenedor interno)
    &:hover {
        --background: #{color.adjust($azul-oscuro, $lightness: 5%)};
    }

    &.segment-button-checked {
        --background: #{color.adjust($azul-oscuro, $lightness: 8%)};
    }

    // Botones de acción dentro del tab - ESQUINA SUPERIOR DERECHA
    .tab-actions {
        position: absolute;
        top: 4px;
        right: -4px; // ALINEACIÓN: Compensar 16px de padding interno del Shadow DOM (12px - 16px = -4px)
        display: flex;
        gap: 4px;
        opacity: 0;
        transition: opacity 0.2s ease;

        ion-button {
            --padding-start: 6px;
            --padding-end: 6px;
            height: 32px; // ESTANDARIZADO
            min-height: 32px;
            min-width: auto;
            font-size: 0.875rem; // 14px - NORMALIZADO con botón Crear

            ion-icon {
                font-size: 0.95rem;
            }

            // Desktop: Mostrar texto + ícono + ANCHO UNIFORME
            @media (min-width: 992px) {
                min-width: 90px; // ANCHO UNIFORME para todos los botones
                width: 90px; // Forzar ancho fijo

                .button-text {
                    display: inline;
                    margin-left: 4px;
                }
            }

            // Tablet y Mobile: Solo ícono
            @media (max-width: 991px) {
                --padding-start: 4px;
                --padding-end: 4px;
                min-width: 28px;

                .button-text {
                    display: none;
                }
            }
        }
    }

    // Mostrar botones al hover del tab
    &:hover .tab-actions {
        opacity: 1;
    }

    // Siempre mostrar botones en el tab activo
    &.segment-button-checked .tab-actions {
        opacity: 1;
    }

    ion-label {
        text-transform: none;
        overflow: visible;
        white-space: normal;
        line-height: 1.2;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        text-align: left;
        justify-content: center;
        gap: 1px;
        padding: spacing('xs') 0;
        // Removido width: 100% para permitir que padding-right funcione
    }

    .crear-icon {
        font-size: 1.5rem;
        color: $color-success !important;
        --color: #{$color-success};
        margin-bottom: 4px;
    }

    &::part(native) {
        padding-left: spacing('md');
        padding-right: spacing('md');
    }

    &:hover {
        --background: rgba(255, 255, 255, 0.15);
    }
}

// ============================================
// SUBTABS (Detalle / Integrantes / Importar)
// ============================================

ion-card-content>ion-segment {
    --background: rgba($azul-oscuro, 0.04);
    margin-bottom: spacing('md');
    border-radius: $radius-sm;

    ion-segment-button {
        --color: $azul-oscuro;
        --color-checked: $azul-claro;
        --indicator-color: $azul-claro;
        --background-checked: rgba($azul-claro, 0.1);
        --border-radius: #{$radius-sm};

        @include typography('sm', 'normal');
        @include transition(all, $transition-fast);

        &:hover {
            --background: rgba($azul-claro, 0.05);
        }

        ion-icon {
            font-size: 1.1rem;
            margin-bottom: spacing('xs');
        }

        ion-label {
            text-transform: none;
        }
    }
}

// ============================================
// TABS DE GRUPOS
// ============================================

.subtab-content>ion-segment {
    --background: $gris-claro;
    margin-bottom: spacing('md');
    border-radius: $radius-sm;
    padding: spacing('xs');

    ion-segment-button {
        --indicator-color: $azul-oscuro;
        --color: $gris-oscuro;
        --color-checked: $azul-oscuro;
        --background-checked: white;
        --border-radius: #{$radius-sm};

        min-width: 80px;
        @include typography('sm', 'medium');
        @include transition(all, $transition-fast);
        @include card-elevation(1);

        &:hover {
            --background: rgba(255, 255, 255, 0.5);
        }

        &::part(native) {
            padding: spacing('sm') spacing('md');
        }
    }
}

// ============================================
// RESPONSIVE
// ============================================

@include respond-to-max('md') {

    // Tabs principales más compactos en móvil
    .cursos-container>ion-segment {
        padding: spacing('xs');

        ion-segment-button {
            min-width: auto; // Let content define width
            max-width: none; // Allow full width if needed
            width: auto;
            flex: 0 0 auto;
            padding-inline: 12px; // Ensure padding
            font-size: font-size('xs');
            --padding-start: 12px; // Reduce padding since we don't have the big wrapper

            ion-label {
                max-width: none;
            }

            // SHOW MOBILE LABEL, HIDE DESKTOP VIEW
            .tab-label-container {
                padding: 0; // Minimize padding

                .mobile-label {
                    display: block !important; // Force show simplified label
                }

                .desktop-view {
                    display: none !important; // Force hide full details
                }
            }
        }
    }

    // Subtabs con iconos más pequeños
    ion-card-content>ion-segment {
        ion-segment-button {
            font-size: font-size('xs');

            ion-icon {
                font-size: 1rem;
                margin-bottom: 2px;
            }

            ion-label {
                font-size: font-size('xs');
            }
        }
    }

    // Tabs de grupos más compactos
    .subtab-content>ion-segment {
        padding: 2px;

        ion-segment-button {
            min-width: 60px;
            font-size: font-size('xs');

            &::part(native) {
                padding: spacing('xs') spacing('sm');
            }
        }
    }
}

// ============================================
// ACCESIBILIDAD
// ============================================

ion-segment-button {
    @include focus-visible($azul-claro, 2px);

    // Touch target mínimo en móvil
    @include respond-to-max('md') {
        min-height: $touch-target-min;
    }
}

// ============================================
// ANIMACIONES
// ============================================

ion-segment {
    ion-segment-button {
        &::part(indicator) {
            @include transition(transform, $transition-base);
        }

        &::part(indicator-background) {
            border-radius: $radius-sm;
        }
    }
}