/**
 * Estilos para Ion-Segment (Tabs)
 * Usa el sistema de variables y mixins para consistencia
 */

@use 'sass:color';
@use '../styles/variables' as *;
@use '../styles/mixins' as *;
@use '../../../shared/styles/course-tabs' as *;
@use '../../../shared/styles/breakpoints' as bp; // Import breakpoints
@use '../../../shared/styles/typography-mixins' as typo; // Typography mixins

// ============================================
// TABS PRINCIPALES DE CURSOS
// ============================================

.cursos-container>ion-segment {
    background: linear-gradient(135deg, $azul-oscuro 0%, color.adjust($azul-oscuro, $lightness: 10%) 100%);
    border-radius: $radius-md;
    padding: spacing('xs');
    margin-bottom: spacing('md');
    @include card-elevation(2);

    // Tabs de cursos
    ion-segment {
        --background: transparent;
        padding: 0;
        margin: 0;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;

        &::-webkit-scrollbar {
            display: none;
        }
    }

    // Botones de curso individuales
    ion-segment-button {
        --background: #{$azul-oscuro};
        --background-checked: #{$azul-oscuro};
        --color: rgba(255, 255, 255, 0.7);
        --color-checked: #ffffff;
        --indicator-color: var(--azul-claro, #1fb2de);
        --indicator-height: 3px;
        --border-radius: var(--rad-sm, 8px);
        --padding-start: spacing('sm');
        --padding-end: 0; // ALINEACIÓN: Remover padding interno para igualar con botón Crear
        --padding-top: spacing('xs');
        --padding-bottom: spacing('xs');
        --margin-end: spacing('xs');
        min-width: 200px;
        max-width: 280px; // Mobile: limitar ancho
        flex: 0 0 auto;
        text-transform: none;
        font-weight: 600;
        position: relative; // Para posicionar botones de acción
        transition: all 0.2s ease;
        box-shadow: var(--shadow-light, 0 2px 4px rgba(0, 0, 0, 0.1));
        margin-bottom: spacing('xs');

        // Desktop: permitir expansión completa
        @media (min-width: 992px) {
            max-width: none;
        }

        border-left: 15px solid var(--course-stripe-color, var(--azul-oscuro));

        &:hover {
            box-shadow: var(--shadow-medium, 0 4px 8px rgba(0, 0, 0, 0.15));
            transform: translateY(-1px);
        }

        &.segment-button-checked {
            box-shadow: var(--shadow-medium, 0 4px 8px rgba(0, 0, 0, 0.15));
            border: 2px solid #ffffff; // El borde blanco externo se mantiene o se quita? 
            // Si el fondo es blanco, borde blanco no se ve.
            // El usuario dijo "el borde debe ser de color blanco" en el paso anterior.
            // Pero si el fondo es blanco, quizas el borde deba ser transparente o gris?
            // Asumiré que quiere que RESALTE. Si el fondo es azul osucro (pagina) y tab blanco, el borde blanco no hace nada.
            // Pero el contenedor de tabs tiene gradiente azul oscuro.
            // Entonces fondo blanco RESALTA sobre el gradiente.
            border-left-width: 15px;
            border-left-color: var(--course-stripe-color, var(--azul-claro));
            --background: #ffffff;
            --color: #{$azul-oscuro};
            --color-checked: #{$azul-oscuro};

            // Forzar estilos en elementos hijos para el estado seleccionado
            .tab-nombre {
                color: #{$azul-oscuro} !important;
                font-weight: 800 !important; // Extra bold
            }

            .tab-codigo {
                color: rgba($azul-oscuro, 0.85) !important;
                font-weight: 500;
            }
        }

        &.segment-button-layout-icon-top {
            // Asegura que el contenido vertical esté bien alineado
            min-height: 4rem; // ~64px
        }

        &.segment-button-checked {
            font-weight: font-weight('bold');
            --color: #ffffff;
        }

        &.segment-button-has-label-only {
            // Ajustes para tabs con solo label
            min-height: 3rem; // ~48px
        }

        // Contenedor de labels (nombre + código)
        .tab-label-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: spacing('xs');
            transition: all 0.2s ease;

            .tab-content-wrapper {
                background: transparent;
                padding: 0;
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                gap: 2px;
                border: none;
                box-shadow: none;
            }

            // Nombre del curso
            .tab-nombre {
                display: block;
                word-wrap: break-word; // Mobile: permitir saltos de línea
                color: #ffffff;
                @include typo.typography-tab-nombre;
                text-align: left;
                width: 100%;

                // Desktop: una sola fila
                @media (min-width: 992px) {
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }
            }

            // Código del curso - SEGUNDA FILA
            .tab-codigo {
                opacity: 0.75;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 100%;
                display: block;
                color: rgba(255, 255, 255, 0.8);
                @include typo.typography-tab-codigo;
                text-align: left;
            }
        }

        // Efecto hover/checked simplificado (sin contenedor interno)
        &:hover {
            --background: #{color.adjust($azul-oscuro, $lightness: 5%)};
        }

        &.segment-button-checked {
            --background: #{color.adjust($azul-oscuro, $lightness: 8%)};
        }

        // Botones de acción dentro del tab - ESQUINA SUPERIOR DERECHA
        .tab-actions {
            position: absolute;
            top: 4px;
            right: -4px; // ALINEACIÓN: Compensar 16px de padding interno del Shadow DOM (12px - 16px = -4px)
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;

            ion-button {
                --padding-start: 6px;
                --padding-end: 6px;
                height: 32px; // ESTANDARIZADO
                min-height: 32px;
                min-width: auto;
                font-size: 0.875rem; // 14px - NORMALIZADO con botón Crear

                ion-icon {
                    font-size: 0.95rem;
                }

                // Desktop: Mostrar texto + ícono + ANCHO UNIFORME
                @media (min-width: 992px) {
                    min-width: 90px; // ANCHO UNIFORME para todos los botones
                    width: 90px; // Forzar ancho fijo

                    .button-text {
                        display: inline;
                        margin-left: 4px;
                    }
                }

                // Tablet y Mobile: Solo ícono
                @media (max-width: 991px) {
                    --padding-start: 4px;
                    --padding-end: 4px;
                    min-width: 28px;

                    .button-text {
                        display: none;
                    }
                }
            }
        }

        // Mostrar botones al hover del tab
        &:hover .tab-actions {
            opacity: 1;
        }

        // Siempre mostrar botones en el tab activo
        &.segment-button-checked .tab-actions {
            opacity: 1;
        }

        ion-label {
            text-transform: none;
            overflow: visible;
            white-space: normal;
            line-height: 1.2;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
            justify-content: center;
            gap: 1px;
            padding: spacing('xs') 0;
            // Removido width: 100% para permitir que padding-right funcione
        }

        .crear-icon {
            font-size: 1.5rem;
            color: $color-success !important;
            --color: #{$color-success};
            margin-bottom: 4px;
        }

        &::part(native) {
            padding-left: spacing('md');
            padding-right: spacing('md');
        }

        &:hover {
            --background: rgba(255, 255, 255, 0.15);
        }
    }
}

// ============================================
// SUBTABS (Detalle / Integrantes / Importar)
// ============================================

ion-card-content>ion-segment {
    --background: rgba($azul-oscuro, 0.04);
    margin-bottom: spacing('md');
    border-radius: $radius-sm;

    ion-segment-button {
        --color: $azul-oscuro;
        --color-checked: $azul-claro;
        --indicator-color: $azul-claro;
        --background-checked: rgba($azul-claro, 0.1);
        --border-radius: #{$radius-sm};

        @include typography('sm', 'normal');
        @include transition(all, $transition-fast);

        &:hover {
            --background: rgba($azul-claro, 0.05);
        }

        ion-icon {
            font-size: 1.1rem;
            margin-bottom: spacing('xs');
        }

        ion-label {
            text-transform: none;
        }
    }
}

// ============================================
// TABS DE GRUPOS
// ============================================

.subtab-content>ion-segment {
    --background: $gris-claro;
    margin-bottom: spacing('md');
    border-radius: $radius-sm;
    padding: spacing('xs');

    ion-segment-button {
        --indicator-color: $azul-oscuro;
        --color: $gris-oscuro;
        --color-checked: $azul-oscuro;
        --background-checked: white;
        --border-radius: #{$radius-sm};

        min-width: 80px;
        @include typography('sm', 'medium');
        @include transition(all, $transition-fast);
        @include card-elevation(1);

        &:hover {
            --background: rgba(255, 255, 255, 0.5);
        }

        &::part(native) {
            padding: spacing('sm') spacing('md');
        }
    }
}

// ============================================
// RESPONSIVE
// ============================================

@include respond-to-max('md') {

    // Tabs principales más compactos en móvil
    .cursos-container>ion-segment {
        padding: spacing('xs');

        ion-segment-button {
            min-width: 100px;
            font-size: font-size('xs');

            ion-label {
                max-width: none;
            }
        }
    }

    // Subtabs con iconos más pequeños
    ion-card-content>ion-segment {
        ion-segment-button {
            font-size: font-size('xs');

            ion-icon {
                font-size: 1rem;
                margin-bottom: 2px;
            }

            ion-label {
                font-size: font-size('xs');
            }
        }
    }

    // Tabs de grupos más compactos
    .subtab-content>ion-segment {
        padding: 2px;

        ion-segment-button {
            min-width: 60px;
            font-size: font-size('xs');

            &::part(native) {
                padding: spacing('xs') spacing('sm');
            }
        }
    }
}

// ============================================
// ACCESIBILIDAD
// ============================================

ion-segment-button {
    @include focus-visible($azul-claro, 2px);

    // Touch target mínimo en móvil
    @include respond-to-max('md') {
        min-height: $touch-target-min;
    }
}

// ============================================
// ANIMACIONES
// ============================================

ion-segment {
    ion-segment-button {
        &::part(indicator) {
            @include transition(transform, $transition-base);
        }

        &::part(indicator-background) {
            border-radius: $radius-sm;
        }
    }
}