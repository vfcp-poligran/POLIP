<ion-content [fullscreen]="true">
  <div class="page-container">
    <!-- Versión Escritorio: Segmentos y Contenido Dinámico -->
    @if (!isMobile) {
    <ion-segment [value]="tabActivo" (ionChange)="cambiarTab($event)" mode="ios" class="sistema-tabs">
      <ion-segment-button value="interfaz">
        <ion-icon name="color-palette"></ion-icon>
        <ion-label>Interfaz</ion-label>
      </ion-segment-button>
      <ion-segment-button value="database">
        <ion-icon name="build"></ion-icon>
        <ion-label>Mantenimiento</ion-label>
      </ion-segment-button>
      <ion-segment-button value="about">
        <ion-icon name="information-circle"></ion-icon>
        <ion-label>Información</ion-label>
      </ion-segment-button>
    </ion-segment>

    <div class="tabs-content">
      <!-- Contenido de Interfaz -->
      @if (tabActivo === 'interfaz') {
      <ng-container *ngTemplateOutlet="interfazTemplate"></ng-container>
      }
      <!-- Contenido de Mantenimiento -->
      @if (tabActivo === 'database') {
      <ng-container *ngTemplateOutlet="mantenimientoTemplate"></ng-container>
      }
      <!-- Contenido de Información -->
      @if (tabActivo === 'about') {
      <ng-container *ngTemplateOutlet="informacionTemplate"></ng-container>
      }
    </div>
    }

    <!-- Versión Móvil: Acordeón para Mantenimiento e Información -->
    @if (isMobile) {
    <div class="mobile-container">
      <!-- Interfaz siempre visible en la parte superior -->
      <ng-container *ngTemplateOutlet="interfazTemplate"></ng-container>

      <!-- Acordeón para secciones secundarias -->
      <ion-accordion-group class="sistema-accordion">
        <ion-accordion value="mantenimiento">
          <ion-item slot="header" color="light">
            <ion-icon name="build" slot="start" color="primary"></ion-icon>
            <ion-label>Mantenimiento</ion-label>
          </ion-item>
          <div class="ion-padding" slot="content">
            <ng-container *ngTemplateOutlet="mantenimientoTemplate"></ng-container>
          </div>
        </ion-accordion>

        <ion-accordion value="informacion">
          <ion-item slot="header" color="light">
            <ion-icon name="information-circle" slot="start" color="secondary"></ion-icon>
            <ion-label>Acerca de / Información</ion-label>
          </ion-item>
          <div class="ion-padding" slot="content">
            <ng-container *ngTemplateOutlet="informacionTemplate"></ng-container>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </div>
    }

    <!-- Templates Compartidos -->
    <ng-template #interfazTemplate>
      <ion-card class="priority-section">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="color-palette"></ion-icon>
            Preferencias de Interfaz
          </ion-card-title>
          <ion-card-subtitle>Personaliza la experiencia visual</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item>
              <ion-icon name="contrast" slot="start" color="primary"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Tema de la Aplicación</h3>
                <p class="text-gray-medium">Cambiar entre tema claro y oscuro</p>
              </ion-label>
              <app-theme-toggle slot="end"></app-theme-toggle>
            </ion-item>
            <ion-item>
              <ion-icon name="color-wand" slot="start" color="secondary"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Animaciones de Tabs</h3>
                <p class="text-gray-medium">Transiciones personalizadas en segmentos</p>
              </ion-label>
              <ion-toggle slot="end" [checked]="tabAnimationsEnabled()"
                (ionChange)="toggleTabAnimations($event)"></ion-toggle>
            </ion-item>
            <ion-item>
              <ion-icon name="notifications" slot="start" color="success"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Mensajes Emergentes</h3>
                <p class="text-gray-medium">Mostrar notificaciones toast</p>
              </ion-label>
              <ion-toggle slot="end" [checked]="mostrarMensajesEmergentes"
                (ionChange)="toggleMensajesEmergentes($event)"></ion-toggle>
            </ion-item>
            <ion-item>
              <ion-icon name="warning" slot="start" color="warning"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Aviso de Selección de Curso</h3>
                <p class="text-gray-medium">Mostrar aviso al editar sin curso seleccionado</p>
              </ion-label>
              <ion-toggle slot="end" [checked]="!ocultarAvisoEdicionSinSeleccion"
                (ionChange)="toggleAvisoEdicion($event)"></ion-toggle>
            </ion-item>
            <ion-item>
              <ion-icon name="time" slot="start" color="tertiary"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Duración de Mensajes</h3>
                <p class="text-gray-medium">{{ duracionToast }} segundo{{ duracionToast > 1 ? 's' : '' }}</p>
              </ion-label>
              <div slot="end" style="display: flex; gap: 8px; align-items: center;">
                <ion-button fill="clear" size="small" (click)="decrementarDuracion()" [disabled]="duracionToast <= 1">
                  <ion-icon slot="icon-only" name="remove-circle"></ion-icon>
                </ion-button>
                <ion-badge color="primary">{{ duracionToast }}s</ion-badge>
                <ion-button fill="clear" size="small" (click)="incrementarDuracion()" [disabled]="duracionToast >= 4">
                  <ion-icon slot="icon-only" name="add-circle"></ion-icon>
                </ion-button>
              </div>
            </ion-item>
            <ion-item>
              <ion-icon name="list" slot="start" color="primary"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Tab Características en Cursos</h3>
                <p class="text-gray-medium">Mostrar tab de características en todos los cursos</p>
              </ion-label>
              <ion-toggle slot="end" [checked]="mostrarTabCaracteristicas()"
                (ionChange)="toggleTabCaracteristicas($event)">
              </ion-toggle>
            </ion-item>
          </ion-list>
          @if (mostrarTabCaracteristicas()) {
          <ion-list class="cursos-checkbox-list">
            <ion-item>
              <ion-label>
                <h3 class="h3-plataforma-blue">Ocultar en cursos específicos</h3>
                <p class="text-gray-medium">Selecciona los cursos donde NO quieres ver el tab</p>
              </ion-label>
            </ion-item>
            @for (curso of cursosDisponibles(); track curso.codigo) {
            <ion-item>
              <ion-checkbox slot="start" [checked]="isCursoConTabOculto(curso.codigo)"
                (ionChange)="toggleCursoTabOculto(curso.codigo)">
              </ion-checkbox>
              <ion-label>
                <h4>{{ curso.nombre }}</h4>
                <p>{{ curso.codigo }}</p>
              </ion-label>
            </ion-item>
            }
          </ion-list>
          }
        </ion-card-content>
      </ion-card>
    </ng-template>

    <ng-template #mantenimientoTemplate>
      <ion-card class="priority-section">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="build"></ion-icon>
            Mantenimiento
          </ion-card-title>
          <ion-card-subtitle>Herramientas de mantenimiento de la base de datos</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item button (click)="exportarBaseDatosCompleta()">
              <ion-icon name="cloud-download" slot="start" color="success"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Exportar Base de Datos</h3>
                <p class="text-gray-medium">Descargar backup completo (JSON)</p>
              </ion-label>
              <ion-icon name="chevron-forward" slot="end"></ion-icon>
            </ion-item>
            <ion-item button (click)="fileInputDB.click()">
              <ion-icon name="cloud-upload" slot="start" color="primary"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Importar Base de Datos</h3>
                <p class="text-gray-medium">Restaurar desde archivo JSON</p>
              </ion-label>
              <ion-icon name="chevron-forward" slot="end"></ion-icon>
            </ion-item>
            <input #fileInputDB type="file" accept=".json,application/json" (change)="onBaseDatosFileSelected($event)"
              style="display: block; width: 0; height: 0; opacity: 0; position: absolute; pointer-events: none;" />
            <ion-item button (click)="limpiarBaseDatosEstadoCero()">
              <ion-icon name="trash" slot="start" color="danger"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Limpiar Base de Datos</h3>
                <p class="text-gray-medium">Eliminar evaluaciones y estados</p>
              </ion-label>
              <ion-icon name="chevron-forward" slot="end"></ion-icon>
            </ion-item>
            <ion-item button (click)="limpiarCachePWA()">
              <ion-icon name="brush" slot="start" color="warning"></ion-icon>
              <ion-label>
                <h3 class="h3-plataforma-blue">Limpiar Caché PWA</h3>
                <p class="text-gray-medium">Eliminar archivos cacheados (no afecta datos)</p>
              </ion-label>
              <ion-icon name="chevron-forward" slot="end"></ion-icon>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    </ng-template>

    <ng-template #informacionTemplate>
      <ion-card class="priority-section">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="information-circle"></ion-icon>
            Información del Sistema
          </ion-card-title>
          <ion-card-subtitle>Detalles del stack tecnológico</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <div class="info-grid">
            <div class="info-column">
              <h4 class="column-title">Aplicación</h4>
              <ion-list>
                <ion-item>
                  <ion-icon name="apps" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Nombre</h3>
                    <p class="text-gray-medium">POLI Project</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="document-text" slot="start" color="secondary"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Descripción</h3>
                    <p class="text-gray-medium">Sistema de Gestión de Proyectos Académicos</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="code-slash" slot="start" color="tertiary"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Versión</h3>
                    <p class="text-gray-medium">4.0.0 (2025)</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="person" slot="start" color="success"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Autor</h3>
                    <p class="text-gray-medium">Víctor Castro Pérez</p>
                    <p class="text-gray-medium">vfcastro@poligran.edu.co</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="school" slot="start" color="warning"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Institución</h3>
                    <p class="text-gray-medium">Politécnico Grancolombiano</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </div>
            <div class="info-column">
              <h4 class="column-title">Stack Tecnológico</h4>
              <ion-list>
                <ion-item>
                  <ion-icon name="logo-angular" slot="start" color="danger"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Frontend</h3>
                    <p class="text-gray-medium">Angular 17 + Ionic 8</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="logo-javascript" slot="start" color="warning"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Lenguaje</h3>
                    <p class="text-gray-medium">TypeScript 5.2</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="save" slot="start" color="success"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Almacenamiento</h3>
                    <p class="text-gray-medium">{{ storageInfo.storage }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="desktop" slot="start" color="medium"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Plataforma</h3>
                    <p class="text-gray-medium">{{ storageInfo.platform === 'web' ? 'Web (PWA)' : 'Móvil (Android/iOS)'
                      }}</p>
                  </ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon name="cloud" slot="start" color="primary"></ion-icon>
                  <ion-label>
                    <h3 class="h3-plataforma-blue">Tipo</h3>
                    <p class="text-gray-medium">Progressive Web App</p>
                  </ion-label>
                </ion-item>
              </ion-list>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </ng-template>
  </div>
</ion-content>