<ion-content [fullscreen]="true">
  <div class="page-container">
    <div class="tab-content calificaciones-tab-content">

      <!-- Header superior: Selector de curso -->
      <div class="header-selector-cursos">
        <div class="selector-left">
          <span class="selector-label">Curso:</span>
          @if (cursosConCalificaciones.length > 0) {
            <select class="curso-select"
              [value]="cursoCalificacionesSeleccionado || ''"
              (change)="seleccionarCursoCalificaciones($any($event.target).value)">
              <option value="" disabled>Seleccionar curso...</option>
              @for (curso of cursosConCalificaciones; track curso.codigo) {
                <option [value]="curso.codigo">{{ curso.nombre }} ({{ curso.codigo }})</option>
              }
            </select>
          } @else {
            <span class="no-cursos">Sin archivos cargados</span>
          }
        </div>
        @if (cursoCalificacionesSeleccionado && csvCalificacionesTabla) {
          <div class="selector-right">
            <span class="archivo-nombre">{{ archivoCalificacionesVisualizacion?.nombre }}</span>
            <span class="archivo-fecha">{{ formatearFecha(archivoCalificacionesVisualizacion?.fechaCarga) }}</span>
            <ion-button size="small" fill="solid" color="success"
              (click)="exportarCalificaciones(cursoCalificacionesSeleccionado)">
              <ion-icon name="download-outline" slot="start"></ion-icon>
              Exportar
            </ion-button>
            <ion-button size="small" fill="outline" color="danger"
              (click)="eliminarArchivoCalificacionesCurso(cursoCalificacionesSeleccionado)">
              <ion-icon name="trash-outline" slot="start"></ion-icon>
              Eliminar
            </ion-button>
          </div>
        }
      </div>

      <!-- Ãrea principal: Tabla de calificaciones -->
      <div class="tabla-area">
        @if (cursoCalificacionesSeleccionado && csvCalificacionesTabla) {
          <!-- Info de conteo -->
          <div class="tabla-info-bar">
            <ion-chip color="primary" class="chip-info">
              <ion-label>{{ csvCalificacionesTabla.filas.length }} estudiantes</ion-label>
            </ion-chip>
            <ion-chip color="secondary" class="chip-info">
              <ion-label>{{ csvCalificacionesTabla.headers.length }} columnas</ion-label>
            </ion-chip>
          </div>

          <!-- Tabla con scroll -->
          <div class="tabla-wrapper">
            <table class="tabla-calificaciones">
              <thead>
                <tr>
                  @for (header of csvCalificacionesTabla.headers; track $index) {
                    <th class="tabla-header" [class.col-numeric]="esColumnaNumerico(header)">
                      {{ header }}
                    </th>
                  }
                </tr>
              </thead>
              <tbody>
                @for (fila of csvCalificacionesTabla.filas; track $index; let isOdd = $odd) {
                  <tr [class.fila-par]="!isOdd" [class.fila-impar]="isOdd">
                    @for (celda of fila; track celdaIndex; let celdaIndex = $index) {
                      <td
                        class="tabla-cell"
                        [class.cell-numeric]="esNumerico(celda)"
                        [class.cell-grade-high]="esCalificacionAlta(celda)"
                        [class.cell-grade-low]="esCalificacionBaja(celda)">
                        {{ celda || '-' }}
                      </td>
                    }
                  </tr>
                }
              </tbody>
            </table>
          </div>
        } @else {
          <!-- Empty state -->
          <div class="empty-state">
            <ion-icon name="bar-chart-outline"></ion-icon>
            <p>Selecciona un curso para ver sus calificaciones</p>
          </div>
        }
      </div>

    </div>
  </div>
</ion-content>
