<div class="shell-container" id="main-content">
  <!-- Header móvil con logo y botones de acción -->
  @if (!isDesktop) {
  <ion-header class="mobile-header">
    <ion-toolbar color="primary">
      <ion-buttons slot="start">
        <!-- FAB de Búsqueda -->
        <ion-button fill="clear" (click)="toggleSearch()" [attr.aria-label]="'Buscar'">
          <ion-icon slot="icon-only" [name]="isSearchOpen ? 'close' : 'search'"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-title class="mobile-app-title">
        <ion-avatar class="header-logo-avatar">
          <img src="assets/icon/logo-poli-simple.svg" alt="Logo Poli" class="app-logo-img" />
        </ion-avatar>
        <div class="app-title-stack">
          <span class="title-main">POLI</span>
          <span class="title-sub">Project</span>
        </div>
      </ion-title>
    </ion-toolbar>

    <!-- Panel de búsqueda desplegable -->
    @if (isSearchOpen) {
    <div class="mobile-search-panel" [@slideDown]>
      <ion-searchbar [(ngModel)]="globalSearchTerm" (ionInput)="onGlobalSearch($event)"
        placeholder="Buscar estudiante, curso..." mode="ios" class="global-searchbar" (keyup.enter)="executeSearch()"
        animated>
      </ion-searchbar>

      @if (globalSearchResults.length > 0) {
      <div class="search-results-panel">
        @for (result of globalSearchResults; track result.id) {
        <div class="search-result-item" (click)="navigateToResult(result)">
          <ion-icon [name]="result.type === 'student' ? 'person-outline' : 'school-outline'"></ion-icon>
          <div class="result-info">
            <span class="result-name">{{ result.name }}</span>
            <span class="result-meta">{{ result.meta }}</span>
          </div>
          <ion-icon name="chevron-forward-outline" class="chevron"></ion-icon>
        </div>
        }
      </div>
      }
    </div>
    }
  </ion-header>
  } @else {
  <div class="desktop-nav-bar" role="navigation" aria-label="Navegación principal">
    <ion-buttons>
      <ion-button *ngFor="let item of navigationItems" [fill]="currentUrl.includes(item.path) ? 'solid' : 'clear'"
        color="light" (click)="router.navigate([item.path])">
        <ion-icon slot="start" [name]="currentUrl.includes(item.path) ? item.icon : item.iconOutline"></ion-icon>
        {{ item.label }}
      </ion-button>


    </ion-buttons>

    <div class="desktop-nav-brand">
      <ion-avatar class="header-logo-avatar">
        <img
          src="https://instructure-uploads.s3.amazonaws.com/account_89940000000000001/attachments/673675/logocanvas.png"
          alt="Logo Poli" />
      </ion-avatar>
      <div class="app-title-stack">
        <span class="title-main">POLI</span>
        <span class="title-sub">Project</span>
      </div>
    </div>
  </div>
  }

  <div class="main-content-area" [class.has-bottom-tabs]="!isDesktop" [class.search-open]="isSearchOpen"
    class="full-width">
    <ion-router-outlet></ion-router-outlet>
  </div>

  @if (!isDesktop) {
  <ion-tab-bar class="mobile-bottom-tabs" slot="bottom">
    <ion-tab-button *ngFor="let item of navigationItems" [routerLink]="[item.path]" routerLinkActive="tab-selected">
      <ion-icon [name]="currentUrl.includes(item.path) ? item.icon : item.iconOutline"></ion-icon>
      <ion-label>{{ item.shortLabel || item.label }}</ion-label>
    </ion-tab-button>
  </ion-tab-bar>
  }
</div>